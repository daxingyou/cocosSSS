{"version":3,"sources":["HTTP.js"],"names":["URL","HTTP","cc","Class","extends","Component","statics","server_token","uid","hall_token","hall_url","tick_url","h_tick_url","tick_idx","hall_idx","game_token","game_url","send","url","data","cb","token","timestamp","Math","round","Date","getTime","vstring","xhr","loader","getXMLHttpRequest","timeout","str","k","requestURL","encodeURI","open","sys","isNative","setRequestHeader","onreadystatechange","readyState","status","ret","JSON","parse","responseText","e","console","log","vv","wc","g_heartbeat","http","method","login","setInterval","mj","game_cfg","g_tick","set_tick_host","hosts","length","set_hall_host","startHallTick","Task","onTask","_hallTick","sendTick","resp","action","evt","newTickEvt","handleTickEvt","host","sendHall","sendGame","joinRoom","tryJoinRoom","room_id","req","errno","mgr","self_seat","seat","mjroom","detail","onJoinSSSRoom","roomId","serverType","onEnter","errcode","sssNetMgr","connectGameServer","user","roomid","sssHttp","sendRequest","recoverGame","timeout_timer","setTimeout","clearTimeout","game_type","room","i","msgs","msg","newEvt","recover","heartbeat","startHeartbeat","game_heartbeat","self","stopHeartbeat","clear_evts","offTask","id","logout"],"mappings":"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","file":"HTTP.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\lib","sourcesContent":["// var URL = \"http://127.0.0.1:9000\";\r\n// var URL = \"http://106.75.133.193:8128/hall\";\r\n// var URL =\"http://192.168.1.128:1279/hall\"\r\nvar URL = \"http://106.75.101.90:1279/hall\";\r\n// var URL = \"http://192.168.1.7:8775/hall\";\r\nimport MD5 from './md5'\r\n\r\nvar HTTP = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    statics: {\r\n        server_token: \"543037c262e95170c6d0a4889e67bef9\",\r\n\r\n        uid: null,\r\n        hall_token: null,\r\n        hall_url: [URL],\r\n        // tick_url: ['http://106.75.133.193:26647/tick'],\r\n        // h_tick_url: 'http://106.75.133.193:26641/tick',\r\n        tick_url: ['http://106.75.101.90:1277/tick'],\r\n        h_tick_url: 'http://106.75.101.90:1277/tick',\r\n        tick_idx: 0,\r\n        hall_idx: 0,\r\n        game_token: null,\r\n        game_url: null,\r\n        send: function (url, data, cb, token) {\r\n            if (token) {\r\n                data['uid'] = this.uid\r\n                // 签名\r\n                let timestamp = Math.round(new Date().getTime() / 1000)\r\n                data[\"__timestamp\"] = timestamp\r\n                let vstring = \"token=\" + token + \"&timestamp=\" + timestamp + \"&uid=\" + this.uid + \"&\" + this.server_token\r\n                data[\"__sign\"] = MD5(vstring)\r\n            }\r\n            var xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.timeout = 60000;\r\n            var str = \"?\";\r\n            for (var k in data) {\r\n                if (str != \"?\") {\r\n                    str += \"&\";\r\n                }\r\n                str += k + \"=\" + data[k];\r\n            }\r\n            var requestURL = url + encodeURI(str);\r\n            // console.log(\"RequestURL:\" + requestURL);\r\n            xhr.open(\"POST\", requestURL, true);\r\n            if (cc.sys.isNative) {\r\n                xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\", \"text/html;charset=UTF-8\");\r\n            }\r\n\r\n            xhr.onreadystatechange = function () {\r\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                    // console.log(\"http res(\" + xhr.responseText.length + \"):\" + xhr.responseText);\r\n                    try {\r\n                        var ret = JSON.parse(xhr.responseText);\r\n                        if (cb !== null) {\r\n                            cb(ret);\r\n                        }                        /* code */\r\n                    } catch (e) {\r\n                        console.log(e)\r\n                        console.log(\"err:\" + e);\r\n                        //handler(null);\r\n                    }\r\n                    finally {\r\n                        if (cc.vv && cc.vv.wc) {\r\n                            //       cc.vv.wc.hide();    \r\n                        }\r\n                    }\r\n                }\r\n            };\r\n\r\n            if (cc.vv && cc.vv.wc) {\r\n                //cc.vv.wc.show();\r\n            }\r\n            xhr.send();\r\n            return xhr;\r\n        },\r\n        g_heartbeat: function () {\r\n            let url = this.h_tick_url + '/heartbeat'\r\n            // let url = this.h_tick_url \r\n            http.send(url, { method: 'heartbeat', uid: this.uid, login: 1 }, () => { })\r\n            setInterval(() => {\r\n                http.send(url, { method: 'heartbeat', uid: this.uid }, () => { })\r\n            }, cc.mj.game_cfg.g_tick ? cc.mj.game_cfg.g_tick : 30000)\r\n        },\r\n        set_tick_host: function (hosts) {\r\n            // cc.log(hosts)\r\n            if (hosts && hosts.length) {\r\n                this.tick_url = hosts\r\n                // this.hall_url = hosts\r\n            }\r\n        },\r\n        set_hall_host: function (hosts) {\r\n            if (hosts && hosts.length) {\r\n                this.hall_url = hosts\r\n                // this.tick_url = hosts\r\n            }\r\n        },\r\n        startHallTick: function () {\r\n            Task.onTask(3000, () => {\r\n                this._hallTick()\r\n            })\r\n        },\r\n        _hallTick: function () {\r\n            http.sendTick({ method: \"event.list\" }, (resp) => {\r\n                if (resp.action) {\r\n                    cc.mj.evt.newTickEvt(resp)\r\n                }\r\n            })\r\n            cc.mj.evt.handleTickEvt()\r\n        },\r\n        sendTick: function (data, cb) {\r\n            this.tick_idx = (this.tick_idx + 1) % this.tick_url.length\r\n            let url = this.tick_url[this.tick_idx] \r\n            if (typeof url != \"string\") {\r\n                url = this.tick_url[this.hall_idx].host\r\n            }\r\n            this.send(url + '/' + data.method, data, cb, this.hall_token)\r\n            // this.send(url, data, cb, this.hall_token)\r\n        },\r\n        sendHall: function (data, cb) {\r\n            this.hall_idx = (this.hall_idx + 1) % this.hall_url.length\r\n            var url = this.hall_url[this.hall_idx]\r\n            if (typeof url != \"string\"){\r\n                url = this.hall_url[this.hall_idx].host\r\n            }\r\n            this.send(url, data, cb, this.hall_token)\r\n        },\r\n        sendGame: function (data, cb) {\r\n            this.send(this.game_url, data, cb, this.game_token)\r\n        },\r\n        joinRoom: function (host, token, cb) {\r\n            this.game_url = host\r\n            this.game_token = token\r\n            this.sendGame({ method: \"join_room\", uid: this.uid, token: this.game_token }, cb)\r\n        },\r\n        tryJoinRoom: function (room_id, cb) {\r\n            let req = { method: \"join_room\" }\r\n            if (room_id) {\r\n                req[\"room_id\"] = room_id\r\n            }\r\n            http.sendHall(req, (resp) => {\r\n                if (!resp.errno) {\r\n                    cc.mj.mgr.self_seat = resp.seat\r\n                    cc.mjroom = resp.detail.detail\r\n                    this.game_url = resp.host\r\n                    this.game_token = resp.token\r\n                    cb && cb(resp)\r\n                } else {\r\n                    cb && cb(resp)\r\n                }\r\n            })\r\n        },\r\n        onJoinSSSRoom: function (roomId) {\r\n            var serverType = 'SSS_SERVER_TYPE'\r\n            var onEnter = function (ret) {\r\n                if (ret.errcode !== 0) {\r\n\r\n                }\r\n                else {\r\n                    cc.sssNetMgr.connectGameServer(ret);\r\n                }\r\n            };\r\n            var data = {\r\n                uid: cc.mj.user.uid,\r\n                serverType: serverType,\r\n                roomid: roomId,\r\n            };\r\n            cc.sssHttp.sendRequest(\"/enter_private_room\", data, onEnter);\r\n        },\r\n        recoverGame: function (cb) {\r\n            let timeout_timer = setTimeout(() => {\r\n                cb()\r\n            }, 1500)\r\n            this.sendHall({ method: \"recover_game\" }, (resp) => {\r\n                clearTimeout(timeout_timer)\r\n                if (!resp.errno) {\r\n                    cc.log(resp.game_type);\r\n                    if (resp.game_type == \"sss\"){\r\n                        cc.log(resp.roomid)\r\n                        this.onJoinSSSRoom(resp.roomid);\r\n                    }else{\r\n                        this.game_url = resp.host\r\n                        this.game_token = resp.token\r\n                        cc.mj.mgr.self_seat = resp.seat\r\n                        cc.mjroom = resp.room\r\n                        this.sendGame({ method: \"recover_game\" }, (resp) => {\r\n                            if (!resp.errno && resp.detail) {\r\n                                cc.mjroom = resp.detail\r\n                                for (let i = 0; i < resp.msgs.length; i++) {\r\n                                    let msg = resp.msgs[i]\r\n                                    cc.mj.evt.newEvt(msg)\r\n                                }\r\n                                cc.mj.mgr.recover = true\r\n                            }\r\n                            cb()\r\n                        })\r\n                    }\r\n                    \r\n                } else {\r\n                    cb()\r\n                }\r\n            })\r\n        },\r\n        heartbeat: function (cb) {\r\n            http.sendGame({ method: \"heartbeat\" }, (resp) => {\r\n                if (resp.msgs) {\r\n                    for (let i = 0; i < resp.msgs.length; i++) {\r\n                        let msg = resp.msgs[i]\r\n                        cc.mj.evt.newEvt(msg)\r\n                    }\r\n                }\r\n                cb && cb()\r\n            }, this.game_token)\r\n        },\r\n        startHeartbeat: function () {\r\n            if (this.game_heartbeat) return\r\n            let self = this\r\n            this.game_heartbeat = function (cb) {\r\n                self.sendGame({ method: \"heartbeat\" }, (resp) => {\r\n                    if (resp.msgs) {\r\n                        for (let i = 0; i < resp.msgs.length; i++) {\r\n                            let msg = resp.msgs[i]\r\n                            cc.mj.evt.newEvt(msg)\r\n                        }\r\n                    }\r\n                    cb && cb()\r\n                }, self.game_token)\r\n            }\r\n            Task.onTask(200, this.game_heartbeat)\r\n        },\r\n        stopHeartbeat: function () {\r\n            this.game_heartbeat && this.game_heartbeat(() => { cc.mj.evt.clear_evts() })\r\n            if (this.game_heartbeat) {\r\n                Task.offTask(this.game_heartbeat)\r\n                this.game_heartbeat = null\r\n            }\r\n        },\r\n        login: function (resp) {\r\n            this.uid = resp.id\r\n            this.hall_token = resp.token\r\n            this.g_heartbeat()\r\n        },\r\n        logout: function () {\r\n            this.uid = null\r\n            this.hall_token = null\r\n        },\r\n    },\r\n});"]}