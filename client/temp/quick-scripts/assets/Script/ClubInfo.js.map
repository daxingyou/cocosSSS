{"version":3,"sources":["ClubInfo.js"],"names":["cc","Class","extends","Component","properties","club_member_prefab","Prefab","integral_history_prefab","label_title","Label","member_layout","Node","node_info","node_member","node_integral","label_integral","label_club_name","label_club_id","lable_created","labale_member_num","init","club","active","club_type","string","integral","name","club_name","club_id","created","slice","cur_num","max_num","instantiate_member","data","load_idx","member","instantiate","parent","getChildByName","getComponent","nickname","Utils","UrlImage","icon","err","sprite","Sprite","spriteFrame","uid","status","showInfo","showMembers","members","http","sendTick","resp","unshift","mj","user","mjroom","onCheckIntegralHistory","node","onReqExit","content","scene","onShowTips","sendHall","update","dt","length"],"mappings":"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","file":"ClubInfo.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        club_member_prefab: cc.Prefab,\r\n        integral_history_prefab: cc.Prefab,\r\n        label_title: cc.Label,\r\n        member_layout: cc.Node,\r\n        node_info: cc.Node,\r\n        node_member: cc.Node,\r\n        node_integral: cc.Node,\r\n\r\n        label_integral: cc.Label,\r\n        label_club_name: cc.Label,\r\n        label_club_id: cc.Label,\r\n        lable_created: cc.Label,\r\n        labale_member_num: cc.Label\r\n    },\r\n    init: function (club) {\r\n        this.club = club\r\n        this.node_integral.active = club.club_type == \"INTEGRAL_CLUB\"\r\n        this.label_integral.string = club.integral\r\n\r\n        let name = club.club_type == \"INTEGRAL_CLUB\" ? \"积分圈\" : \"朋友圈\"\r\n        this.label_title.string = name + \" 详情\"\r\n\r\n        this.label_club_name.string = name + \"名称: \" + club.club_name\r\n        this.label_club_id.string = name + \"ID: \" + club.club_id\r\n        this.lable_created.string = \"创建时间: \" + club.created.slice(0, 11)\r\n        this.labale_member_num.string = \"人数: \" + (club.cur_num + \" / \" + club.max_num)\r\n    },\r\n    instantiate_member: function (data) {\r\n        this.load_idx += 1\r\n        let member = cc.instantiate(this.club_member_prefab)\r\n        member.parent = this.member_layout\r\n        member.getChildByName(\"name\").getComponent(cc.Label).string = data.nickname\r\n        Utils.UrlImage(data.icon, (err, sprite) => {\r\n            !err && (member.getChildByName(\"icon\").getComponent(cc.Sprite).spriteFrame = sprite)\r\n        })\r\n        member.getChildByName(\"uid\").getComponent(cc.Label).string = \"ID: \" + data.uid\r\n        member.getChildByName(\"created\").getComponent(cc.Label).string = data.created.slice(0, 11)\r\n        let status = member.getChildByName(data.status)\r\n        status ? (status.active = true) : null;\r\n    },\r\n    showInfo: function () {\r\n        this.node_info.active = true\r\n        this.node_member.active = false\r\n    },\r\n    showMembers: function () {\r\n        this.node_info.active = false\r\n        this.node_member.active = true\r\n        if (!this.members) {\r\n            this.load_idx = 0\r\n            http.sendTick({ \"method\": \"club.members\", club_id: this.club.club_id }, (resp) => {\r\n                resp.members.unshift({ uid: cc.mj.user.uid, \"icon\": cc.mj.user.icon, \"nickname\": cc.mj.user.nickname, \"status\": cc.mjroom ? \"PLAYING\" : \"ONLINE\" })\r\n                this.members = resp.members\r\n            })\r\n        }\r\n    },\r\n    onCheckIntegralHistory: function () {\r\n        let node = cc.instantiate(this.integral_history_prefab)\r\n        node.getComponent(\"IntegralRecord\").init(this.club.club_id)\r\n        node.parent = this.node\r\n    },\r\n    onReqExit: function () {\r\n        let content = this.club.integral > 0 ? \"尚有积分未兑换，是否确认退出积分圈\" : (\"是否确认退出\" + (this.club.club_type == \"INTEGRAL_CLUB\" ? \"积分圈\" : \"朋友圈\"))\r\n        cc.scene.onShowTips(\"OK_CANCEL\", content, () => {\r\n            http.sendHall({ \"method\": \"exit_club\", club_id: this.club.club_id }, (resp) => {\r\n                cc.scene.onShowTips(\"OK\", \"退出俱乐部申请已提交，等待管理员处理\")\r\n            })\r\n        })\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.members && this.load_idx < this.members.length) {\r\n            this.instantiate_member(this.members[this.load_idx])\r\n        }\r\n    },\r\n});\r\n"]}