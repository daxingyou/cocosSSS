{"version":3,"sources":["CreateRoom.js"],"names":["CREATE_ERROR","cc","Class","extends","Component","properties","option_prefab","default","type","Prefab","room_option","Node","btn_fzmj","btn_ndmj","btn_sss","tips_prefab","onLoad","mode","defauleMode","getComponent","init","room_type","refresh_fangka","bind","toggle","Toggle","check","onToggle","e","sys","localStorage","setItem","fangka","node","getChildByName","Label","string","onCreateRoom","option","getOptions","log","mj","conf","suit","length","color","join","data","uid","user","club_id","cur_club","site_num","max_role","round_num","round","koufeixuanze","pay","wait_sec","forcibly_time","shoot_multi","multiples","wanfa","ext","lengthx","sssHttp","sendRequest","ret","console","errcode","scene","onShowTips","sssNetMgr","connectGameServer","http","sendHall","method","num","JSON","stringify","resp","errno","mgr","self_seat","seat","mjroom","detail","game_url","host","game_token","token","gotoGame","content","club_type","getItem","start"],"mappings":"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","file":"CreateRoom.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar CREATE_ERROR = {\r\n    10079: \"已达每日限额，创建房间失败\",\r\n    10077: \"积分不足， 创建房间失败\",\r\n    10080: \"您的房卡余额不足，请联系官方客服或代理充值购买，谢谢！\",\r\n    10078: \"俱乐部房卡余额不足，请联系俱乐部管理\",\r\n    10081: \"积分余额不足，创建房间失败，请联系俱乐部管理\",\r\n}\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        option_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        room_option: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        btn_fzmj: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        btn_ndmj: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        btn_sss: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        tips_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        }\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        this.mode = this.defauleMode()\r\n        this.room_option.getComponent(\"RoomOption\").init(this.room_type(), this.mode, this.refresh_fangka.bind(this))\r\n        let toggle = this.mode == \"fzmj\" ? this.btn_fzmj : this.mode == \"ndmj\" ? this.btn_ndmj:this.btn_sss\r\n        toggle.getComponent(cc.Toggle).check()  \r\n    },\r\n    onToggle: function (e, mode) {\r\n        this.mode = mode\r\n        this.room_option.getComponent(\"RoomOption\").init(this.room_type(), mode, this.refresh_fangka.bind(this))\r\n        cc.sys.localStorage.setItem(\"default_mj\", this.mode)\r\n    },\r\n    refresh_fangka: function (fangka) {\r\n        this.node.getChildByName(\"fangka\").getComponent(cc.Label).string = fangka\r\n    },\r\n    onCreateRoom: function () {\r\n        let option = this.room_option.getComponent(\"RoomOption\").getOptions()\r\n        cc.log(option);\r\n        // cc.log(this.room_option.getComponent(\"RoomOption\"))\r\n        if (option.mj==\"sss\"){\r\n            let conf = {}\r\n            if(option.suit.length>0){\r\n                var  color=option.suit.join(\",\");\r\n            }\r\n            var data = {\r\n                uid: cc.mj.user.uid,\r\n                club_id: cc.cur_club ? cc.cur_club.club_id : 0,\r\n                site_num: option.max_role,\r\n                round_num: option.round,\r\n                koufeixuanze:option.pay,\r\n                wait_sec: option.forcibly_time,\r\n                shoot_multi: option.multiples ? option.multiples:1,\r\n                color: color?color:'',\r\n                wanfa: option.ext.lengthx>0?1:0,\r\n                type: option.mode\r\n            };\r\n            // console.log(data);\r\n            cc.sssHttp.sendRequest(\"/create_private_room\", data, (ret)=>{\r\n                console.log(ret)\r\n                if (ret.errcode !== 0) {\r\n                    if (ret.errcode == 2222) {\r\n                        cc.scene.onShowTips(\"OK\", \"钻石不足，创建房间失败!\");\r\n                    } \r\n                    else if (ret.errcode==4){\r\n                        cc.scene.onShowTips(\"OK\", \"房卡不足，创建房间失败!\");\r\n                    }\r\n                    else {\r\n                        cc.scene.onShowTips(\"OK\", \"创建房间失败,错误码:\" + ret.errcode);\r\n                    }\r\n                }\r\n                else {\r\n                    cc.sssNetMgr.connectGameServer(ret);\r\n                }\r\n            });\r\n        }else{\r\n            http.sendHall({ method: \"create_room\", club_id: cc.cur_club ? cc.cur_club.club_id : 0, num: option.max_role, mode: this.mode, option: JSON.stringify(option) }, (resp) => {\r\n                if (!resp.errno) {\r\n                    cc.mj.mgr.self_seat = resp.seat\r\n                    cc.mjroom = resp.detail.detail\r\n                    http.game_url = resp.host\r\n                    http.game_token = resp.token\r\n\r\n                    cc.scene.gotoGame(\"正在进入牌局\")\r\n                } else {\r\n                    let content = CREATE_ERROR[resp.errno]\r\n                    if (!content) {\r\n                        content = \"发生错误啦，请联系官方客服(错误ID:\" + resp.errno + \")\"\r\n                    }\r\n                    cc.scene.onShowTips(\"OK\", content)\r\n                }\r\n            })\r\n        }\r\n        \r\n    },\r\n    room_type: function () {\r\n        return cc.cur_club ? cc.cur_club.club_type : \"PERSONAL\"\r\n    },\r\n    defauleMode: function () {\r\n        let mode = cc.sys.localStorage.getItem(\"default_mj\")\r\n        return mode ? mode : \"fzmj\"\r\n    },\r\n    start() {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}