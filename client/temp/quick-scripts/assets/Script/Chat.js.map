{"version":3,"sources":["Chat.js"],"names":["COMMON_MSG","conf","require","cc","Class","extends","Component","properties","one_msg_prefab","default","type","Prefab","content","Node","toggle_common","toggle_emoji","toggle_histroy","atlas_emoji","SpriteAtlas","emoji_prefab","chat_atlas","history_msg_prefab","onLoad","onShowCommonMsg","toggle_dict","COMMON","EMOJI","HISTORY","setLocalZOrder","x","init","msgs","history_msgs","changeToggleBg","cur_toggle","k","toggle","getComponent","Sprite","spriteFrame","getSpriteFrame","removeAllChildren","height","i","length","common_msg","instantiate","onSendMsg","bind","parent","y","onShowHistory","history_msg","onShowEmoji","EMOJI_ID","emoji","sprite","parseInt","on","EventType","TOUCH_END","msg","http","sendGame","method","scene","closePopWin","node","onClickSend","input_msg","onInputEnd","editbox","string"],"mappings":"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","file":"Chat.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["var COMMON_MSG = [\r\n    \"你太牛了\",\r\n    \"哈哈，手气真好\",\r\n    \"快点出牌噢\",\r\n    \"今天真高兴\",\r\n    \"这个吃的好\",\r\n    \"你放炮我不胡\",\r\n    \"你家里是开银行的吧\",\r\n    \"不好意思，我有事要先走一步\",\r\n    \"你的牌打的太好啦\",\r\n    \"大家好，很高兴见到各位\",\r\n    \"怎么又断线了啊，网络怎么这么差啊\",\r\n    \"抱歉，刚接了个电话\"\r\n]\r\nvar conf = require(\"Conf\")\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        one_msg_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        content: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        toggle_common: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        toggle_emoji: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        toggle_histroy: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        atlas_emoji: {\r\n            default: null,\r\n            type: cc.SpriteAtlas\r\n        },\r\n        emoji_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        chat_atlas: {\r\n            default: null,\r\n            type: cc.SpriteAtlas\r\n        },\r\n        history_msg_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        }\r\n    },\r\n    onLoad: function () {\r\n        this.onShowCommonMsg()\r\n        this.toggle_dict = {\r\n            COMMON: this.toggle_common,\r\n            EMOJI: this.toggle_emoji,\r\n            HISTORY: this.toggle_histroy\r\n        }\r\n        this.toggle_common.setLocalZOrder(99)\r\n        this.toggle_common.x = 287\r\n    },\r\n    init: function (msgs) {\r\n        this.history_msgs = msgs\r\n    },\r\n    changeToggleBg: function (cur_toggle) {\r\n        for (let k in this.toggle_dict) {\r\n            let toggle = this.toggle_dict[k]\r\n            if (k == cur_toggle) {\r\n                toggle.getComponent(cc.Sprite).spriteFrame = this.chat_atlas.getSpriteFrame(\"new_chat_selected\")\r\n                toggle.setLocalZOrder(99)\r\n                toggle.x = 287\r\n            } else {\r\n                toggle.getComponent(cc.Sprite).spriteFrame = this.chat_atlas.getSpriteFrame(\"new_chat_not_selected\")\r\n                toggle.setLocalZOrder(0)\r\n                toggle.x = 286\r\n            }\r\n        }\r\n    },\r\n    onShowCommonMsg: function () {\r\n        this.content.removeAllChildren()\r\n        this.content.height = 0\r\n        for (let i = 0; i < COMMON_MSG.length; i++) {\r\n            let common_msg = cc.instantiate(this.one_msg_prefab)\r\n            common_msg.getComponent(\"OneMsg\").init(COMMON_MSG[i], this.onSendMsg.bind(this, COMMON_MSG[i]))\r\n            common_msg.parent = this.content\r\n            common_msg.y = -(common_msg.height + 10) * i\r\n            this.content.height += common_msg.height + 10\r\n        }\r\n        this.changeToggleBg(\"COMMON\")\r\n    },\r\n    onShowHistory: function () {\r\n        this.content.removeAllChildren()\r\n        this.content.height = 0\r\n        for (let i = 0; i < this.history_msgs.length; i++) {\r\n            let history_msg = cc.instantiate(this.history_msg_prefab)\r\n            history_msg.getComponent(\"OneHistoryMsg\").init(this.history_msgs[i])\r\n            history_msg.parent = this.content\r\n            history_msg.y = -(history_msg.height) * i\r\n            this.content.height += history_msg.height\r\n        }\r\n        this.changeToggleBg(\"HISTORY\")\r\n    },\r\n    onShowEmoji: function () {\r\n        this.content.removeAllChildren()\r\n        this.content.height = 0\r\n        let EMOJI_ID = conf.EMOJI_ID\r\n        for (let i = 0; i < EMOJI_ID.length; i++) {\r\n            let emoji = cc.instantiate(this.emoji_prefab)\r\n            let sprite = this.atlas_emoji.getSpriteFrame(EMOJI_ID[i]);\r\n            emoji.getComponent(cc.Sprite).spriteFrame = sprite\r\n            emoji.parent = this.content\r\n            emoji.x = (64 + 10) * (i % 5)\r\n            emoji.y = -64 * parseInt(i / 5) - 10\r\n            this.content.height += emoji.height\r\n            emoji.on(cc.Node.EventType.TOUCH_END, this.onSendMsg.bind(this, EMOJI_ID[i]))\r\n        }\r\n        this.content.height = parseInt(this.content.height / 5) + EMOJI_ID.length * 2\r\n        this.changeToggleBg(\"EMOJI\")\r\n    },\r\n    onSendMsg: function (msg) {\r\n        http.sendGame({ method: \"send_msg\", msg: msg }, () => { })\r\n        cc.scene.closePopWin(this.node)\r\n    },\r\n    onClickSend: function () {\r\n        this.input_msg && this.onSendMsg(this.input_msg)\r\n    },\r\n    onInputEnd: function (editbox) {\r\n        this.input_msg = editbox.string\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    // start () {\r\n\r\n    // },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}