{"version":3,"sources":["App.js"],"names":["initMgr","cc","vv","UserMgr","require","userMgr","gameType","ReplayMgr","replayMgr","AnysdkMgr","anysdkMgr","init","VoiceMgr","voiceMgr","Global","Class","extends","Component","onLoad","console","log","sys","isNative","isMobile","cvs","node","getComponent","Canvas","fitHeight","fitWidth","Utils","utils","global","ver","gametype","mj","invition_delay","evt","AudioMgr","audio","user","mgr","window","http","sendHall","method","resp","game_cfg","set_tick_host","tick","set_hall_host","hall","ver_valid","undefined","director","loadScene","sssNetMgr","sssHttp","Net","sssNet","Emitter","emitter","getScreenShotImagePath","fullPath","jsb","fileUtils","getWritablePath","os","OS_ANDROID","isFileExist","removeFile","screenShoot","func","size","getWinSize","currentDate","Date","fileName","valueOf","texture","RenderTexture","Math","floor","width","height","setPosition","p","begin","getRunningScene","visit","end","imagePath","saveToFile","ImageFormat","PNG","fileData","getDataFromFile","writeDataToFile"],"mappings":"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","file":"App.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["function initMgr() {\r\n    cc.vv = {};\r\n    var UserMgr = require(\"UserMgr\");\r\n    cc.vv.userMgr = new UserMgr();\r\n    cc.vv.userMgr.gameType=\"SSS_SERVER_TYPE\";\r\n\r\n    var ReplayMgr = require(\"ReplayMgr\");\r\n    cc.vv.replayMgr = new ReplayMgr();\r\n\r\n    var AnysdkMgr = require(\"./AnysdkMgr\");\r\n    cc.vv.anysdkMgr = new AnysdkMgr();\r\n    cc.vv.anysdkMgr.init();\r\n\r\n    var VoiceMgr = require(\"VoiceMgr\");\r\n    cc.vv.voiceMgr = new VoiceMgr();\r\n    cc.vv.voiceMgr.init();\r\n\r\n    // var AudioMgr = require(\"AudioMgr\");\r\n    // cc.vv.audioMgr = new AudioMgr();\r\n    // cc.vv.audioMgr.init();\r\n\r\n    // var Utils = require(\"./sssUtils\");\r\n    // cc.vv.utils = new Utils();\r\n    // cc.vv.global = require(\"Global\");\r\n}\r\nvar Global = cc.Class({\r\n    extends: cc.Component,\r\n    onLoad: function () {\r\n        console.log(\"app start\")\r\n        if (!cc.sys.isNative && cc.sys.isMobile) {\r\n            var cvs = this.node.getComponent(cc.Canvas);\r\n            cvs.fitHeight = true;\r\n            cvs.fitWidth = true;\r\n        }\r\n        // initMgr();\r\n        // 十三水 vv\r\n        cc.vv = {};\r\n        var UserMgr = require(\"sssUserMgr\");\r\n        cc.vv.userMgr = new UserMgr();\r\n        cc.vv.userMgr.gameType=\"SSS_SERVER_TYPE\"\r\n\r\n        var AnysdkMgr = require(\"./AnysdkMgr\");\r\n        cc.vv.anysdkMgr = new AnysdkMgr();\r\n        cc.vv.anysdkMgr.init();\r\n\r\n        var Utils = require(\"sssUtils\");\r\n        cc.vv.utils = new Utils();\r\n\r\n        var ReplayMgr = require(\"ReplayMgr\");\r\n        cc.vv.replayMgr = new ReplayMgr();\r\n    \r\n        var VoiceMgr = require(\"VoiceMgr\");\r\n        cc.vv.voiceMgr = new VoiceMgr();\r\n        cc.vv.voiceMgr.init();\r\n        cc.vv.global = require(\"Global\");\r\n\r\n\r\n        // 麻将mj\r\n        cc.ver = 2\r\n        cc.gametype = \"MJ\"\r\n\r\n        cc.mj = {}\r\n        cc.invition_delay = {}\r\n        cc.mj.evt = require(\"./EvtMgr\")\r\n        cc.mj.evt.init()\r\n\r\n        var AudioMgr = require(\"AudioMgr\");\r\n        cc.audio = new AudioMgr();\r\n        cc.audio.init();\r\n\r\n        cc.mj.user = require(\"./UserMgr\")\r\n        cc.mj.user.init()\r\n        \r\n        \r\n\r\n        cc.mj.mgr = require('./MJMgr')\r\n        window.http = require(\"./lib/HTTP\")\r\n        http.sendHall({ method: \"game.cfg\", ver: cc.ver }, (resp) => {\r\n            cc.mj.game_cfg = resp; http.set_tick_host(resp.tick); http.set_hall_host(resp.hall)\r\n            cc.ver_valid = resp.ver_valid != undefined ? resp.ver_valid : true\r\n            cc.director.loadScene(\"login\")\r\n        })\r\n\r\n        let sssNetMgr = require(\"./sss/sssNetMgr\")\r\n        cc.sssNetMgr = new sssNetMgr()\r\n        cc.sssHttp = require(\"./sss/sssgame/sssHttp\")\r\n        var Net = require(\"./sss/Net\");\r\n        cc.sssNet = new Net();\r\n\r\n        var Emitter = require(\"./sss/common/emitter\")\r\n        cc.emitter = new Emitter();\r\n\r\n        var getScreenShotImagePath = function () {\r\n            var fullPath = jsb.fileUtils.getWritablePath() + 'ScreenShotShare.png'; //拿到可写路径，将图片保存在本地，可以在ios端或者java端读取该文件\r\n            if (cc.sys.os == cc.sys.OS_ANDROID) {\r\n                fullPath = '/sdcard/ScreenShotShare.png';\r\n            }\r\n            if (jsb.fileUtils.isFileExist(fullPath)) {\r\n                jsb.fileUtils.removeFile(fullPath);\r\n            }\r\n            return fullPath;\r\n        }\r\n\r\n        cc.screenShoot = function (func) {\r\n            var size = cc.director.getWinSize();\r\n            var currentDate = new Date();\r\n            let fileName = 'fnyl-' + (new Date()).valueOf() + '.png';\r\n            var fullPath = '/sdcard/' + fileName;\r\n            if (jsb.fileUtils.isFileExist(fullPath)) {\r\n                jsb.fileUtils.removeFile(fullPath);\r\n            }\r\n            var texture = new cc.RenderTexture(Math.floor(size.width), Math.floor(size.height));\r\n            texture.setPosition(cc.p(size.width / 2, size.height / 2));\r\n            texture.begin();\r\n            cc.director.getRunningScene().visit();\r\n            texture.end();\r\n            var imagePath = getScreenShotImagePath();\r\n            //saveToFile 是放在jsb.fileUtils.getWritablePath()的路径中，只能传入文件名。传不了路径\r\n            texture.saveToFile(\"ScreenShotShare.png\", cc.ImageFormat.PNG, true, function () {\r\n                if (jsb.fileUtils.isFileExist(jsb.fileUtils.getWritablePath() + \"ScreenShotShare.png\")) {\r\n                    if (cc.sys.os == cc.sys.OS_ANDROID) {//安卓的分享路径比较坑，只能重新写文件\r\n                        var fileData = jsb.fileUtils.getDataFromFile(jsb.fileUtils.getWritablePath() + \"ScreenShotShare.png\");\r\n                        jsb.fileUtils.writeDataToFile(fileData, imagePath);\r\n                        jsb.fileUtils.removeFile(jsb.fileUtils.getWritablePath() + \"ScreenShotShare.png\");//写了新文件后删除旧文件\r\n                    }\r\n                    func && func(imagePath)\r\n                    //shareImage(imagePath);//微信分享接口，需要自己实现\r\n                }\r\n                // shareNode.position = position;\r\n            });\r\n\r\n            // texture.saveToFile(fileName, cc.IMAGE_FORMAT_JPG);\r\n            // return fullPath\r\n        };\r\n    }\r\n});"]}