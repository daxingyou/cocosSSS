{"version":3,"sources":["PopupMgr.js"],"names":["cc","Class","extends","Component","properties","_popuproot","_settings","_dissolveNotice","_endTime","_extraInfo","_noticeLabel","_noticePlayerLabel","onLoad","vv","popupMgr","find","active","getChildByName","getComponent","Label","closeAll","addBtnHandler","self","emitter","on","dissolveNotice","bind","dissolveCancel","removeHandler","stopEndTime","node","event","data","detail","showDissolveNotice","off","log","start","gameType","userMgr","serverType","sssNetMgr","dissoveData","btnName","btn","addClickEvent","target","component","handler","eventHandler","EventHandler","clickEvents","Button","push","onBtnClicked","name","sssNet","send","showSettings","showDissolveRequest","replayMgr","isReplay","Date","now","time","seats","i","length","b","states","update","dt","lastTime","m","Math","floor","s","ceil","str","string"],"mappings":"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","file":"PopupMgr.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\sss\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _popuproot:null,\r\n        _settings:null,\r\n        _dissolveNotice:null,\r\n        \r\n        _endTime:-1,\r\n        _extraInfo:null,\r\n        _noticeLabel:null,\r\n        _noticePlayerLabel:null,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(cc.vv == null){\r\n            return;\r\n        }\r\n        cc.vv.popupMgr = this;\r\n        \r\n        this._popuproot = cc.find(\"Canvas/popups\");\r\n        this._popuproot.active = false;\r\n        this._settings = cc.find(\"Canvas/popups/settings\");\r\n        this._dissolveNotice = cc.find(\"Canvas/popups/dissolve_notice\");\r\n        this._noticeLabel = this._dissolveNotice.getChildByName(\"info0\").getComponent(cc.Label);\r\n        this._noticePlayerLabel = this._dissolveNotice.getChildByName(\"info\").getComponent(cc.Label);\r\n        \r\n        this.closeAll();\r\n        \r\n        // this.addBtnHandler(\"settings/btn_close\");\r\n        this.addBtnHandler(\"settings/btn_sqjsfj\");\r\n        this.addBtnHandler(\"dissolve_notice/btn_agree\");\r\n        this.addBtnHandler(\"dissolve_notice/btn_reject\");\r\n        //this.addBtnHandler(\"dissolve_notice/btn_ok\");\r\n        \r\n        var self = this;\r\n\r\n        cc.emitter.on('dissolve_notice', this.dissolveNotice.bind(this));\r\n        cc.emitter.on('dissolve_cancel', this.dissolveCancel.bind(this));\r\n        cc.emitter.on('remove_handler', this.removeHandler.bind(this));\r\n        cc.emitter.on('stopEndTime', this.stopEndTime.bind(this));\r\n        \r\n        this.node.on(\"dissolve_notice\",function(event){\r\n            var data = event.detail;\r\n            self.showDissolveNotice(data);\r\n        });\r\n        \r\n        this.node.on(\"dissolve_cancel\",function(event){\r\n            self.closeAll();\r\n        });\r\n    },\r\n\r\n    removeHandler:function(){\r\n        cc.emitter.off('dissolve_notice');\r\n        cc.emitter.off('dissolve_cancel');\r\n        cc.emitter.off('remove_handler');\r\n    },\r\n\r\n    dissolveNotice:function(data){\r\n        cc.log(data);\r\n        cc.log(\"@@@@@@@@@@@@@@@@@@@@\");\r\n        this.showDissolveNotice(data);\r\n    },\r\n\r\n    dissolveCancel:function(){\r\n        this.closeAll();\r\n    },\r\n\r\n    start:function(){\r\n        var gameType = cc.vv.userMgr.serverType;\r\n        if(cc.sssNetMgr.dissoveData) {\r\n            if('SSS_SERVER_TYPE' === gameType){\r\n                this.showDissolveNotice(cc.sssNetMgr.dissoveData);\r\n            }\r\n        }\r\n    },\r\n    \r\n    addBtnHandler:function(btnName){\r\n        var btn = cc.find(\"Canvas/popups/\" + btnName);\r\n        this.addClickEvent(btn,this.node,\"PopupMgr\",\"onBtnClicked\");\r\n    },\r\n    \r\n    addClickEvent:function(node,target,component,handler){\r\n        var eventHandler = new cc.Component.EventHandler();\r\n        eventHandler.target = target;\r\n        eventHandler.component = component;\r\n        eventHandler.handler = handler;\r\n\r\n        var clickEvents = node.getComponent(cc.Button).clickEvents;\r\n        clickEvents.push(eventHandler);\r\n    },\r\n\r\n    stopEndTime:function(){\r\n        this._endTime = 0;\r\n    },\r\n    \r\n    onBtnClicked:function(event){\r\n        this.closeAll();\r\n        // var gameType = cc.vv.userMgr.serverType;\r\n        var gameType = 'SSS_SERVER_TYPE';\r\n\r\n        var btnName = event.target.name;\r\n\r\n        if('SSS_SERVER_TYPE' === gameType){\r\n            if(btnName == \"btn_agree\"){\r\n                cc.sssNet.send(\"dissolve_agree\");\r\n            }\r\n            else if(btnName == \"btn_reject\"){\r\n                cc.sssNet.send(\"dissolve_reject\");\r\n            }\r\n            else if(btnName == \"btn_sqjsfj\"){\r\n                cc.sssNet.send(\"dissolve_request\"); \r\n            }\r\n        }\r\n       \r\n    },\r\n    \r\n    closeAll:function(){\r\n        if(this._popuproot){\r\n            this._popuproot.active = false;\r\n            this._settings.active = false;\r\n            this._dissolveNotice.active = false;\r\n        }\r\n    },\r\n    \r\n    showSettings:function(){\r\n        if(this._popuproot){\r\n            this.closeAll();\r\n            this._popuproot.active = true;\r\n            this._settings.active = true;\r\n        }\r\n    },\r\n    \r\n    showDissolveRequest:function(){\r\n        this.closeAll();\r\n        this._popuproot.active = true;\r\n    },\r\n    \r\n    showDissolveNotice:function(data){\r\n        if (cc.vv.replayMgr.isReplay()) {\r\n            return;\r\n        }\r\n        this._endTime = Date.now()/1000 + data.time;\r\n        this._extraInfo = \"\";\r\n        cc.log(cc.sssNetMgr.seats)\r\n        for(var i = 0; i < cc.sssNetMgr.seats.length; ++i){\r\n            if(cc.sssNetMgr.seats[i].name !=''){\r\n                var b = data.states[i];\r\n                var name = '';\r\n                    name = cc.sssNetMgr.seats[i].name;\r\n                if(b){\r\n                    this._extraInfo += \"\\n[已同意] \"+ name;\r\n                }\r\n                else{\r\n                    this._extraInfo += \"\\n[待确认] \"+ name;\r\n                }\r\n            }\r\n            \r\n        }\r\n        this.closeAll();\r\n        this._popuproot.active = true;\r\n        this._dissolveNotice.active = true;;\r\n    },\r\n    \r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n        if(this._endTime > 0){\r\n            var lastTime = this._endTime - Date.now() / 1000;\r\n            if(lastTime < 0){\r\n                this._endTime = -1;\r\n                // var gameType = cc.vv.userMgr.serverType;\r\n                // if('SSS_SERVER_TYPE' === gameType){\r\n                //     cc.sssNet.send(\"dispress\");\r\n                // }\r\n            }\r\n            \r\n            var m = Math.floor(lastTime / 60);\r\n            var s = Math.ceil(lastTime - m*60);\r\n            \r\n            var str = \"\";\r\n            if(m > 0){\r\n                str += m + \"分\"; \r\n            }\r\n            \r\n            this._noticeLabel.string = str + s + \"秒后房间将自动解散\";\r\n        }\r\n        this._noticePlayerLabel.string = this._extraInfo + \"\\n  \";\r\n    },\r\n});\r\n"]}