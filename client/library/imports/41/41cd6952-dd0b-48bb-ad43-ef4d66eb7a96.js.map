{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Report1.js"],"names":["cc","Class","extends","Component","properties","report_prefab","default","type","Prefab","btn_exit","Node","btn_continue","btn_check_hua","hua_show_prefab","final_prefab","btn_final_check","btn_share","detail_info","Label","onLoad","mjroom","option","mj","active","on","EventType","TOUCH_START","onCheckHua","bind","result","handle","onExitGame","onContinueGame","share","onCheckFinal","banker","win","role","resport_panel","find","role_num","roles","length","resport_layout","getComponent","Layout","spacingY","i","rp","instantiate","cs","init","seat","name","cards","score","detail","parent","mgr","self_seat","audio","playSFX","evt","regEvt","data","director","loadScene","id","cur_round","round","option_text","time","string","http","sendGame","method","resp","hua_show","node","text","indexOf","share_plugin","anysdk","agentManager","getSharePlugin","setListener","onShareResult","info","shareTo","mediaType","title","code","ShareResultCode","kShareSuccess","kShareFail","kShareCancel","kShareNetworkError"],"mappings":"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","file":"Report1.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        report_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        btn_exit: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        btn_continue: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        btn_check_hua: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        hua_show_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        final_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        btn_final_check: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        btn_share: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        detail_info: {\r\n            default: null,\r\n            type: cc.Label\r\n        }\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n    onLoad: function () {\r\n        if (cc.mjroom.option.mj != \"fzmj\") {\r\n            this.btn_check_hua.active = false\r\n        } else {\r\n            this.btn_check_hua.on(cc.Node.EventType.TOUCH_START, this.onCheckHua.bind(this))\r\n        }\r\n        this.result = cc.mj.result\r\n        let result = cc.mj.result\r\n        if (result.handle == \"EXIT_OR_CONTINUE\") {\r\n            this.btn_exit.active = true\r\n            this.btn_exit.on(cc.Node.EventType.TOUCH_START, this.onExitGame.bind(this))\r\n\r\n            this.btn_continue.active = true\r\n            this.btn_continue.on(cc.Node.EventType.TOUCH_START, this.onContinueGame.bind(this))\r\n        } else if (result.handle == \"SHARE_OR_CONTINUE\") {\r\n            this.btn_share.active = true\r\n            this.btn_share.on(cc.Node.EventType.TOUCH_START, this.share.bind(this))\r\n\r\n            this.btn_continue.active = true\r\n            this.btn_continue.on(cc.Node.EventType.TOUCH_START, this.onContinueGame.bind(this))\r\n        } else if (result.handle == \"SHARE_OR_FINAL_CHECK\") {\r\n            this.btn_share.active = true\r\n            this.btn_share.on(cc.Node.EventType.TOUCH_START, this.share.bind(this))\r\n\r\n            this.btn_final_check.active = true\r\n            this.btn_final_check.on(cc.Node.EventType.TOUCH_START, this.onCheckFinal.bind(this))\r\n        }\r\n\r\n        let banker = result.banker\r\n        let win = result.role\r\n        let resport_panel = cc.find(\"Canvas/bg/report\")\r\n        let role_num = result.roles.length\r\n        let resport_layout = resport_panel.getComponent(cc.Layout)\r\n        if (role_num == 2) {\r\n            resport_layout.spacingY = 150\r\n        } else if (role_num == 3) {\r\n            resport_layout.spacingY = 50\r\n        }\r\n        for (let i = 0; i < role_num; i++) {\r\n            let role = result.roles[i]\r\n            let rp = cc.instantiate(this.report_prefab)\r\n            let cs = rp.getComponent(\"Report1Prefab\")\r\n            cs.init(role.seat, role.name, role.seat == banker.seat, role.seat == win.seat, role.cards, role.score, role.detail)\r\n            rp.parent = resport_panel\r\n        }\r\n        if (win.seat == cc.mj.mgr.self_seat) {\r\n            cc.find(\"Canvas/bg/result/win\").active = true\r\n            cc.audio.playSFX(\"common/audio_win.mp3\")\r\n        } else if (win.seat == null) {\r\n            cc.find(\"Canvas/bg/result/liuju\").active = true\r\n            cc.audio.playSFX(\"common/audio_liuju.mp3\")\r\n        } else {\r\n            cc.find(\"Canvas/bg/result/lose\").active = true\r\n            cc.audio.playSFX(\"common/audio_lose.mp3\")\r\n        }\r\n        cc.mj.evt.regEvt(\"ExitRoom\", (data) => {\r\n            cc.director.loadScene(\"hall\")\r\n        })\r\n\r\n        let detail = \"\"\r\n        detail += \"房号 \" + result.detail.id + \" 当前局数: 第\" + result.detail.cur_round + \"/\" + result.detail.option.round + \"局\\n\"\r\n        detail += result.detail.option_text + \"\\n\"\r\n        detail += result.detail.time + \"\\n\"\r\n        this.detail_info.string = detail\r\n        cc.mj.result = null\r\n    },\r\n    init: function () {\r\n\r\n    },\r\n    onExitGame: function () {\r\n        http.sendGame({ method: \"exit_game\" }, (resp) => { cc.mjroom = null; cc.director.loadScene(\"hall\") })\r\n    },\r\n    onContinueGame: function () {\r\n        http.sendGame({ method: \"continue_game\" }, (resp) => { cc.mjroom.cur_round += 1; cc.director.loadScene(\"mjgame\") })\r\n    },\r\n    onCheckHua: function () {\r\n        http.sendGame({ method: \"check_hua\" }, (resp) => {\r\n            let hua_show = cc.instantiate(this.hua_show_prefab)\r\n            hua_show.parent = this.node\r\n            let cs = hua_show.getComponent(\"RoleHuaShow\")\r\n            cs.init(resp.roles)\r\n        })\r\n    },\r\n    onCheckFinal: function () {\r\n        http.sendGame({ method: \"final_balance\" }, (resp) => {\r\n            let node = cc.instantiate(this.final_prefab)\r\n            node.getComponent(\"Report2\").init(resp)\r\n            node.parent = this.node\r\n        })\r\n    },\r\n\r\n    share: function () {\r\n        let text = \"\"\r\n        text += \"福宁娱乐：房号\" + this.result.detail.id + \"\\n\"\r\n        for (let i = 0; i < this.result.roles.length; i++) {\r\n            let role = this.result.roles[i]\r\n            text += (role.name + \" 得分：\" + role.score + \" \" + (role.detail.indexOf(\"点炮\") != -1 ? \"点炮\" : role.detail.indexOf(\"接炮\") != -1 ? \"接炮\" : \"\")) + \"\\n\"\r\n        }\r\n        var share_plugin = anysdk.agentManager.getSharePlugin();\r\n        share_plugin.setListener(this.onShareResult, this);\r\n\r\n        var info = {\r\n            shareTo: \"0\",\r\n            mediaType: \"0\",\r\n            title: \"福宁娱乐\",   // title 标题，印象笔记、邮箱、信息、微信、人人网和 QQ 空间使用\r\n            text: text,            // text 是分享文本，所有平台都需要这个字段\r\n        }\r\n        share_plugin.share(info)\r\n\r\n    },\r\n    onShareResult: function () {\r\n        switch (code) {\r\n            case anysdk.ShareResultCode.kShareSuccess:\r\n                //do something\r\n                break;\r\n            case anysdk.ShareResultCode.kShareFail:\r\n                //do something\r\n                break;\r\n            case anysdk.ShareResultCode.kShareCancel:\r\n                //do something\r\n                break;\r\n            case anysdk.ShareResultCode.kShareNetworkError:\r\n                //do something\r\n                break;\r\n        }\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {},\r\n\r\n    // start () {\r\n\r\n    // },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}