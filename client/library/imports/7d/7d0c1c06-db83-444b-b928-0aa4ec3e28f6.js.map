{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\lib/assets\\Script\\lib\\Task.js"],"names":["cc","Class","extends","Component","properties","onLoad","window","Task","task_dict","task_cache","once_task_dict","tick","director","getScheduler","schedule","_onTick","onDisable","unschedule","pause","resume","t","cb_list","i","length","onTask","delay","cb","indexOf","push","offTask","idx","splice","e","log","runAfter"],"mappings":"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","file":"Task.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\lib","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n    },\r\n    onLoad: function () {\r\n        window.Task = this\r\n        this.task_dict = {}\r\n        this.task_cache = {}\r\n        this.once_task_dict = {}\r\n        this.tick = 0\r\n        cc.director.getScheduler().schedule(this._onTick, this, 0.016)\r\n    },\r\n    onDisable: function () {\r\n        cc.director.getScheduler().unschedule(this._onTick, this, 0.016)\r\n    },\r\n    pause: function () {\r\n        cc.director.getScheduler().unschedule(this._onTick, this, 0.016)\r\n    },\r\n    resume: function () {\r\n        cc.director.getScheduler().schedule(this._onTick, this, 0.016)\r\n    },\r\n    _onTick: function () {\r\n        this.tick += 1\r\n\r\n        for (let t in this.task_dict) {\r\n            if (this.tick % t != 0) continue\r\n            let cb_list = this.task_dict[t]\r\n            for (let i = 0; i < cb_list.length; i++) {\r\n                cb_list[i]()\r\n            }\r\n        }\r\n        for (let t in this.once_task_dict) {\r\n            if (this.tick < t) continue\r\n            let cb_list = this.once_task_dict[t]\r\n            for (let i = 0; i < cb_list.length; i++) {\r\n                cb_list[i]()\r\n            }\r\n            this.once_task_dict[t] = []\r\n        }\r\n    },\r\n    onTask: function (delay, cb) {\r\n        let t = ~~(delay / 16)\r\n        if (!this.task_dict[t]) {\r\n            this.task_dict[t] = []\r\n        }\r\n        if (this.task_dict[t].indexOf(cb) >= 0) return\r\n        this.task_dict[t].push(cb)\r\n        this.task_cache[cb] = t\r\n    },\r\n    offTask: function (cb) {\r\n        try {\r\n            let t = this.task_cache[cb]\r\n            let idx = this.task_dict[t].indexOf(cb)\r\n            if (t && idx >= 0) {\r\n                this.task_dict[t].splice(idx, 1)\r\n                delete this.task_cache[cb]\r\n            }\r\n        } catch (e) { cc.log(e) }\r\n    },\r\n    runAfter: function (delay, cb) {\r\n        let t = ~~(delay / 16) + this.tick\r\n        if (!this.once_task_dict[t]) {\r\n            this.once_task_dict[t] = []\r\n        }\r\n        this.once_task_dict[t].push(cb)\r\n    }\r\n});"]}